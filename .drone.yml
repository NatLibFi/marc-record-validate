---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:
  - name: Audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: Install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: Test
    image: node:12
    commands:
      - npm test

  - name: Build
    image: node:12
    commands:
    - npm run build
    - npm ci --production

  - name: Static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: Npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:
  - name: Publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: hLAC7UTBDgMtSmyqajTAs+mlPKVVpVjtKaRaicSxBNcAuHeGPBPSrsqUTiCrwAyQUv2LGLmb8oyWTTwZWNXNOw==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 4fb315800e210bf90be26a81788d79c685167210c5308a51aaff3bd1a4246ad2

...
